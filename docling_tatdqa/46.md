The following table presents common shares related to potentially dilutive shares excluded from the calculation of diluted net loss per share as their effect would have been anti-dilutive (in thousands):

|                                                                                            | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   |
|--------------------------------------------------------------------------------------------|----------------------------|----------------------------|----------------------------|
|                                                                                            | 2019                       | 2018                       | 2017                       |
| Stock options, RSUs and employee stock purchase rights . . . . . . . . . . . . . . . . . . | 9,199                      | 9,621                      | 12,184                     |

## 11. Income Taxes

The geographical breakdown of loss before income taxes is as follows (in thousands):

|                                                                                                                         | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   |
|-------------------------------------------------------------------------------------------------------------------------|----------------------------|----------------------------|----------------------------|
|                                                                                                                         | 2019                       | 2018                       | 2017                       |
| Domestic loss . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . | $(20,345)                  | $(29,658)                  | $(13,752)                  |
| Foreign income . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  | 3,933                      | 3,123                      | 4,207                      |
| Loss before income taxes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            | $(16,412)                  | $(26,535)                  | $ (9,545)                  |

The provision for income taxes consisted of the following (in thousands):

|                                                                                                                             | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   |
|-----------------------------------------------------------------------------------------------------------------------------|----------------------------|----------------------------|----------------------------|
|                                                                                                                             | 2019                       | 2018                       | 2017                       |
| Current provision for income taxes:                                                                                         |                            |                            |                            |
| State . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . | $ 49                       | $ 44                       | $ 48                       |
| Foreign. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    | 1,716                      | 953                        | 1,023                      |
| Total current . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           | 1,765                      | 997                        | 1,071                      |
| Deferred tax expense (benefit):                                                                                             |                            |                            |                            |
| Federal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   | 3                          | (13)                       | 26                         |
| Foreign. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    | (361)                      | 98                         | 109                        |
| Total deferred . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            | (358)                      | 85                         | 135                        |
| Provision for income taxes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        | $1,407                     | $1,082                     | $1,206                     |

The reconciliation of the statutory federal income tax and the provision for income tax is as follows (in thousands, except percentages).

|                                                                                                                           | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   | Years Ended December 31,   |
|---------------------------------------------------------------------------------------------------------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|----------------------------|
|                                                                                                                           | 2019                       | 2019                       | 2018                       | 2018                       | 2017                       | 2017                       |
|                                                                                                                           | Amount                     | Percentage                 | Amount                     | Percentage                 | Amount                     | Percentage                 |
| Tax at statutory rate . . . . . . . . . . . . . . . . . . . . . . . . . .                                                 | $(3,447)                   | 21.0%                      | $(5,572)                   | 21.0%                      | $ (3,245)                  | 34.0%                      |
| State tax - net of federal benefits . . . . . . . . . . . . . . .                                                         | 42                         | (0.3)                      | 39                         | (0.1)                      | 32                         | (0.3)                      |
| Foreign rate differential . . . . . . . . . . . . . . . . . . . . . . .                                                   | 363                        | (2.2)                      | 258                        | (1.0)                      | (655)                      | 6.9                        |
| Changes in federal valuation allowance . . . . . . . . . .                                                                | 4,695                      | (28.6)                     | 6,430                      | (24.2)                     | (21,038)                   | 220.4                      |
| Change in federal tax rate due to Tax Cuts and Jobs Act . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . | -                          | -                          | -                          | -                          | 28,185                     | (295.3)                    |
| Stock-based compensation . . . . . . . . . . . . . . . . . . . . .                                                        | 578                        | (3.5)                      | 1,950                      | (7.3)                      | (1,169)                    | 12.2                       |
| Non-deductible meals and entertainment expenses. .                                                                        | 287                        | (1.8)                      | 342                        | (1.3)                      | 243                        | (2.5)                      |
| Other permanent items . . . . . . . . . . . . . . . . . . . . . . . .                                                     | 257                        | (1.6)                      | 351                        | (1.3)                      | 104                        | (1.1)                      |
| Federal tax credits - net of uncertain tax position . .                                                                   | (1,809)                    | 11.0                       | (2,634)                    | 9.9                        | (1,634)                    | 17.1                       |
| Expenses for uncertain tax positions . . . . . . . . . . . . .                                                            | 166                        | (1.0)                      | 137                        | (0.5)                      | 311                        | (3.3)                      |
| Other . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                         | 275                        | (1.6)                      | (219)                      | 0.7                        | 72                         | (0.7)                      |
| Provision for income taxes . . . . . . . . . . . . . . . . . .                                                            | $ 1,407                    |                            | (8.6)% $ 1,082             | (4.1)% $                   | 1,206                      | (12.6)%                    |